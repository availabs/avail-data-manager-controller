BEGIN ;

CREATE TABLE irvs.ebr_s380_v841 (
  LIKE irvs.ebr_s380_v840 INCLUDING ALL,
  PRIMARY KEY (building_id)
) ;

INSERT INTO irvs.ebr_s380_v841 (
  building_id,
  replacement_value,
  critical,
  flood_depth,
  flood_velocity,
  flood_base_elevation,
  value_source,
  flood_zone,
  foundation_type,
  structure_type,
  roof_type,
  building_type,
  num_stories,
  basement,
  num_units,
  prop_class,
  address,
  num_residents,
  num_employees,
  num_occupants,
  num_vehicles_inhabitants,
  height,
  bldg_style,
  sqft_living,
  nbr_kitchens,
  nbr_full_baths,
  nbr_bedrooms,
  first_floor_elevation,
  heat_type,
  naics_code,
  census_industry_code,
  contents_replacement_value,
  inventory_replacement_value,
  establishment_revenue,
  business_hours,
  seismic_zone,
  flood_plain,
  flood_duration,
  high_wind_speed,
  soil_type,
  storage_hazardous_materials,
  topography,
  sewer_type,
  fuel_type,
  water_supply,
  cousub_geoid,
  tract_geoid,
  dup_geoid,
  geoid,
  establishments,
  owner_type,
  parcel_id,
  name,
  type,
  shelter,
  place_geoid,
  user_property_class,
  emergency_generator,
  agency,
  footprint,
  risk_value,
  hazard_loss_percent,
  risk_zone_id,
  hazard_loss_dollars,
  owner,
  nri_avln_eals,
  nri_cfld_eals,
  nri_cwav_eals,
  nri_erqk_eals,
  nri_hail_eals,
  nri_hwav_eals,
  nri_hrcn_eals,
  nri_istm_eals,
  nri_lnds_eals,
  nri_ltng_eals,
  nri_rfld_eals,
  nri_swnd_eals,
  nri_trnd_eals,
  nri_tsun_eals,
  nri_vlcn_eals,
  nri_wfir_eals,
  nri_wntw_eals
)
  SELECT
      building_id,
      a.replacement_value,
      a.critical,
      a.flood_depth,
      a.flood_velocity,
      a.flood_base_elevation,
      a.value_source,
      COALESCE(b.map_fld_zone, a.flood_zone) AS flood_zone,
      a.foundation_type,
      a.structure_type,
      a.roof_type,
      a.building_type,
      a.num_stories,
      a.basement,
      a.num_units,
      a.prop_class,
      a.address,
      a.num_residents,
      a.num_employees,
      a.num_occupants,
      a.num_vehicles_inhabitants,
      a.height,
      a.bldg_style,
      a.sqft_living,
      a.nbr_kitchens,
      a.nbr_full_baths,
      a.nbr_bedrooms,
      a.first_floor_elevation,
      a.heat_type,
      a.naics_code,
      a.census_industry_code,
      a.contents_replacement_value,
      a.inventory_replacement_value,
      a.establishment_revenue,
      a.business_hours,
      a.seismic_zone,
      a.flood_plain,
      a.flood_duration,
      a.high_wind_speed,
      a.soil_type,
      a.storage_hazardous_materials,
      a.topography,
      a.sewer_type,
      a.fuel_type,
      a.water_supply,
      a.cousub_geoid,
      a.tract_geoid,
      a.dup_geoid,
      a.geoid,
      a.establishments,
      a.owner_type,
      a.parcel_id,
      a.name,
      a.type,
      a.shelter,
      a.place_geoid,
      a.user_property_class,
      a.emergency_generator,
      a.agency,
      a.footprint,
      a.risk_value,
      a.hazard_loss_percent,
      a.risk_zone_id,
      a.hazard_loss_dollars,
      a.owner,
      a.nri_avln_eals,
      a.nri_cfld_eals,
      a.nri_cwav_eals,
      a.nri_erqk_eals,
      a.nri_hail_eals,
      a.nri_hwav_eals,
      a.nri_hrcn_eals,
      a.nri_istm_eals,
      a.nri_lnds_eals,
      a.nri_ltng_eals,
      a.nri_rfld_eals,
      a.nri_swnd_eals,
      a.nri_trnd_eals,
      a.nri_tsun_eals,
      a.nri_vlcn_eals,
      a.nri_wfir_eals,
      a.nri_wntw_eals
    FROM irvs.ebr_s380_v840 AS a
      LEFT OUTER JOIN floodplains_work_schema.buildings_to_floodplains AS b
        USING (building_id)
;

COMMIT ;

CLUSTER irvs.ebr_s380_v841
  USING ebr_s380_v841_pkey
;
